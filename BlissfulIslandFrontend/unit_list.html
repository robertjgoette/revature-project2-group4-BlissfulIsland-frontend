<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://use.typekit.net/jyg2wba.css">
    <link rel="icon" type="image/png" href="CSS/Logo-s.png"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./CSS/style.css">
    <title>Unit List</title>
</head>

<body>
    <!--start of  navbar-->
    <header id="navBar" class="navBar">
        <div class="navBar__logo">
            <img id="logoM" class="navBar__img" src="CSS/Logo-M.png" alt="Logo">
        </div>
        <div id="navBarGroup" class="navBar__group">
            <div id="accountMaker" class="navBar__group__links"></div>
            <div id="message" class = "navBar__group__links"></div>
            <div class="navBar__group__links">
                <a id="logOut" onclick="logOut()">Log Out</a>
            </div>
        </div>
    </header>
    <!--end of nav bar-->


    <!--table type test-->
    <div class="unitCard">
        <div class="unitCard__pieChart">
            <canvas id="chart1"></canvas>
        </div>
        <div class="unitCard__attribute">
            <ul>
                <li>Rent: 1,000</li>
                <li>Bed: 1</li>
                <li>Bath: 1</li>
            </ul>
        </div>
        <div class="unitCard__typeName">
            <h2>Regular</h2>
        </div>
        <div class="unitCard__plusBox" onclick="flipPlus()">
            <h3>Unit List</h3>
            <div class="plus__btn unitCard__plusBox__plusBtn">
                <span id="oldPlus" class="plus plus--white"></span>
            </div>
        </div>
    </div>
    <div class="unitCard__avalibilityTable">
        <div id="typeTest" class="tables tables--fill inactive">
            <table id="typeTestTable" class="tables__unit_type">
                <thead>
                    <th class="unitCard__avalibilityTable__unitNumber">Unit Number</th>
                    <th class="unitCard__avalibilityTable__available">Available</th>
                </thead>
                <tbody id="requestUnitList"></tbody>
            </table>
        </div>
    </div>


    <div class="unitCard">
        <div class="unitCard__pieChart">
            <canvas id="chart2"></canvas>
        </div>
        <div class="unitCard__attribute">
            <ul>
                <li>Rent: 1,500</li>
                <li>Bed: 2</li>
                <li>Bath: 2</li>
            </ul>
        </div>
        <div class="unitCard__typeName">
            <h2>Deluxe</h2>
        </div>
        <div class="unitCard__plusBox" onclick="flipPlusN()">
            <h3>Unit List</h3>
            <div class="plus__btn unitCard__plusBox__plusBtn">
                <span id="normalPlus" class="plus plus--white"></span>
            </div>
        </div>
    </div>
    <div class="unitCard__avalibilityTable">
        <div id="typeNormal" class="tables tables--fill inactive">
            <table id="typeTestTable" class="tables__unit_type">
                <thead>
                    <th class="unitCard__avalibilityTable__unitNumber">Unit Number</th>
                    <th class="unitCard__avalibilityTable__available">Available</th>
                </thead>
                <tbody id="requestUnitList1"></tbody>
            </table>
        </div>
    </div>


    <!--table type delux-->
    <div class="unitCard">
        <div class="unitCard__pieChart">
            <canvas id="chart3"></canvas>
        </div>
        <div class="unitCard__attribute">
            <ul>
                <li>Rent: 3,000</li>
                <li>Bed: 4</li>
                <li>Bath: 5.5</li>
            </ul>
        </div>
        <div class="unitCard__typeName">
            <h2>Luxury</h2>
        </div>
        <div class="unitCard__plusBox" onclick="flipPlusD()">
            <h3>Unit List</h3>
            <div class="plus__btn unitCard__plusBox__plusBtn">
                <span id="deluxPlus" class="plus plus--white"></span>
            </div>
        </div>
    </div>
    <div class="unitCard__avalibilityTable">
        <div id="typeDelux" class="tables tables--fill inactive">
            <table id="typeTestTable" class="tables__unit_type">
                <thead>
                    <th class="unitCard__avalibilityTable__unitNumber">Unit Number</th>
                    <th class="unitCard__avalibilityTable__available">Available</th>
                </thead>
                <tbody id="requestUnitList2"></tbody>
            </table>
        </div>
    </div>

</body>
<script src ="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    getUnitList();
    const accountType = localStorage.getItem("accountType");
    const accountId = localStorage.getItem("accountID"); 
    const accountMaker = document.getElementById("accountMaker");
    const unitList = document.getElementById("unitList");
    const navBarGroup = document.getElementById("navBarGroup");
    const navBar = document.getElementById("navBar");
    const message = document.getElementById("message");
    const logoM = document.getElementById("logoM");


    const typeTest = document.getElementById("typeTest");
    const typeNormal = document.getElementById("typeNormal");
    const typeDelux = document.getElementById("typeDelux");
    const oldPlus = document.getElementById("oldPlus");
    const normalPlus = document.getElementById("normalPlus");
    const deluxPlus = document.getElementById("deluxPlus");

    // flip function for type test
    function flipPlus() {
        oldPlus.classList.toggle("plus--acitve")
        if (typeTest.style.maxHeight) {
            typeTest.style.maxHeight = null;
        } else {
            typeTest.style.maxHeight = typeTest.scrollHeight + "px";
        }
    }
    // flip function for type normal
    function flipPlusN() {
        normalPlus.classList.toggle("plus--acitve")
        if (typeNormal.style.maxHeight) {
            typeNormal.style.maxHeight = null;
        } else {
            typeNormal.style.maxHeight = typeNormal.scrollHeight + "px";
        }
    }
    //flip function for type delux
    function flipPlusD() {
        deluxPlus.classList.toggle("plus--acitve")
        if (typeDelux.style.maxHeight) {
            typeDelux.style.maxHeight = null;
        } else {
            typeDelux.style.maxHeight = typeDelux.scrollHeight + "px";
        }
    }
    //function to get the unit list
    async function getUnitList() {
        const response = await fetch(`http://127.0.0.1:7000/typesAvailability`);
        const response2 = await fetch(`http://127.0.0.1:7000/units`);
        if (response.status === 404 || response2.status === 404) {
            return alert("There is no data to retrieve");
        } else {
            const records = await response.json();
            const records2 = await response2.json();
            console.log(records2)
            let tableRow = "";
            let tableRow1 = "";
            let tableRow2 = "";
            for (let record of records2) {
                if(record.typeID == 1) {
                    tableRow += `<tr>
                    <td>${record.apartmentNumber}</td>
                    <td>${record.isAvailable}</td>
                    </tr> `
                }else if(record.typeID == 2) {
                    tableRow1 += `<tr>
                    <td>${record.apartmentNumber}</td>
                    <td>${record.isAvailable}</td>
                    </tr> `
                }else if(record.typeID === 3) {
                    tableRow2 += `<tr>
                    <td>${record.apartmentNumber}</td>
                    <td>${record.isAvailable}</td>
                    </tr> `
                }
            }
            requestUnitList.innerHTML = tableRow;
            requestUnitList1.innerHTML = tableRow1;
            requestUnitList2.innerHTML = tableRow2;
            for (let record of records) {
                if (record.typeId == 1) {
                var available1 = record.available;
                var totalUnitPerType1 = record.totalUnitPerType;
                var inUse1 = totalUnitPerType1-available1;
                }
            } 
            pieChart1(available1, inUse1);
            for (let record of records) {
                if (record.typeId == 2) {
                    available2 = record.available;
                    totalUnitPerType2 = record.totalUnitPerType;
                    inUse2 = totalUnitPerType2-available2;
                }
            }
            pieChart2(available2, inUse2);
            for (let record of records) {
                if (record.typeId === 3) {
                    available3 = record.available;
                    totalUnitPerType3 = record.totalUnitPerType;
                    inUse3 = totalUnitPerType3-available3;
                }
            }
            pieChart3(available3, inUse3);
        }
    }
    
    
    function pieChart1(available, inUse){
        let availableArr =["Available", "Taken"];
        data = {
        labels: availableArr,
        datasets: [{
            label: "chart1",
            backgroundColor: ['#1869A3','#F0A73C'],
            borderColor: ['#3BA4F0', '#A38456'],
            data: [available, inUse],
            }]
        };        
        const config1 = {
            type: 'pie',
            data,
            options: {}
        };
        let chart1 = new Chart(
            document.getElementById('chart1'), config1);
    }
    function pieChart2(available, inUse){
        let availableArr =["Available", "Taken"];
        data = {
        labels: availableArr,
        datasets: [{
            label: "chart2",
            backgroundColor: ['#1869A3','#F0A73C'],
            borderColor: ['#3BA4F0', '#A38456'],
            data: [available, inUse],
            }]
        };        
        const config1 = {
            type: 'pie',
            data,
            options: {}
        };
        let chart2 = new Chart(
            document.getElementById('chart2'), config1);
    }
    function pieChart3(available, inUse){
        let availableArr =["Available", "Taken"];
        data = {
        labels: availableArr,
        datasets: [{
            label: "chart3",
            backgroundColor: ['#1869A3','#F0A73C'],
            borderColor: ['#3BA4F0', '#A38456'],
            data: [available, inUse],
            }]
        };        
        const config1 = {
            type: 'pie',
            data,
            options: {}
        };
        let chart2 = new Chart(
            document.getElementById('chart3'), config1);
    }

</script>
<script src="JS/index.js"></script>

</html>